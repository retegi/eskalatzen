{% extends 'core/base.html' %}

{% load static %}

{% block title %}Euskalmet{% endblock %}

{% block content %}

<div class="container" style="width:800px; margin:0 auto; text-align: center;">
  <table class="table" style="width:50%" >
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Hiria</th>
          <th scope="col">temp max</th>
          <th scope="col">temp min</th>
        </tr>
      </thead>
      <tbody>
        <tr id="tempTabla">

        </tr>
      </tbody>
    </table>
</div>



<div class="jumbotron vertical-center">
      <div class="container">
          <div class="row">
              <div class="col">
                  <h3>Euskalmet</h3>
                  <div id="root"></div>
              </div>
          </div>
        <div class="row">
            <div class="col">
                <img style="width:100%" src="https://www.euskalmet.euskadi.eus/vamet/temps_precipitations_map/today/airTemperature/current/last.jpeg"></img>
            </div>
            <div class="col">
                <img style="width:100%" src="https://www.euskalmet.euskadi.eus/vamet/temps_precipitations_map/today/precipitation/current/last.jpeg" alt="Ãšltimo valor">
            </div>
        </div>
      </div>
</div>
<div class="right-content">
        <div style="position: absolute; top: 0%; left: 0%;" class="map-icon">
            <img src="https://www.euskalmet.euskadi.eus/meteoassets/icons/euskalmet/i01d.svg" alt="Poco nuboso" width="120" height="120">
        </div>
        <div style="position: absolute; top: 0%; left: 83%;" class="map-icon" >
            <img src="https://www.euskalmet.euskadi.eus/meteoassets/icons/euskalmet/i02d.svg" alt="Parcialmente nuboso" width="120" height="120">
        </div>
    </div>
</div>
<script>
//  regionId: basque_country
//  regionZoneId:
//      cantabrian_mountains
//      cantabrian_valleys
//      coast_zone
//      donostialdea
//      ebro_valley
//      great_bilbao
//      interior_basins
//      pyrenees
//      southern_mountain
//      vitoria_gasteiz

window.addEventListener("load", function meteoStationReadings() {
  var headers =
  {
    'accept':'application/json',
    'Authorization': "Bearer eyJhbGciOiJSUzI1NiJ9.eyJhdWQiOiJtZXQwMS5hcGlrZXkiLCJpc3MiOiJUZWNuYWxpYSIsImV4cCI6MTY3NjIwNDc1OCwidmVyc2lvbiI6IjEuMC4wIiwiaWF0IjoxNjM4NDQ3OTU4LCJlbWFpbCI6ImFwcHMuaW5mcmEudGVjbmFsaWFAZ21haWwuY29tIn0.eVQczqFuUDXqSqE4bbc8XYxTxBuNnlJWnpf2dKd2cj9CNFJ6U6N3svz5rFrgpGqskwhkqEo4Bi7w-zgxFu4x_tYzeMX351guT0AFBjVWikCHXXRrPDf1rMJkTD_rNScIFyHHqhXdZ31vE8iJ9Z8zQiAFBUa8bkyehqX-C_96-CQmBBEh4bWW_P6-5nSMrrHH19-8dhT9bGeInXxPnGKBFqiwjJfsrqhpi4Ee6lvCyyeQD0ZJmnRozzqlr80r9N61WwHdWXpez3pdxElFsZ-zOkixkztqo157eTvRyPA1GchX1K3eTkQsLWPExtIZwcydXIYnxH1glWPIKLycLAfiOQ"

  };
  var options = {
    'method' : 'get',
    'contentType': 'application/json',
    'headers': headers,
    'muteHttpExceptions': true
  };

  var urls = "https://api.euskadi.eus/euskalmet/readings/forStation/B090/HA05/measures/measuresForAir/humidity/at/2022/05/26"
  const response = fetch(urls, options);

  fetch(urls, options)
  .then(response => response.json())
  .then(data => {console.log(data)});

}, false);

window.addEventListener("load", function meteoForecast() {
  var headers =
  {
    'accept':'application/json',
    'Authorization': "Bearer eyJhbGciOiJSUzI1NiJ9.eyJhdWQiOiJtZXQwMS5hcGlrZXkiLCJpc3MiOiJUZWNuYWxpYSIsImV4cCI6MTY3NjIwNDc1OCwidmVyc2lvbiI6IjEuMC4wIiwiaWF0IjoxNjM4NDQ3OTU4LCJlbWFpbCI6ImFwcHMuaW5mcmEudGVjbmFsaWFAZ21haWwuY29tIn0.eVQczqFuUDXqSqE4bbc8XYxTxBuNnlJWnpf2dKd2cj9CNFJ6U6N3svz5rFrgpGqskwhkqEo4Bi7w-zgxFu4x_tYzeMX351guT0AFBjVWikCHXXRrPDf1rMJkTD_rNScIFyHHqhXdZ31vE8iJ9Z8zQiAFBUa8bkyehqX-C_96-CQmBBEh4bWW_P6-5nSMrrHH19-8dhT9bGeInXxPnGKBFqiwjJfsrqhpi4Ee6lvCyyeQD0ZJmnRozzqlr80r9N61WwHdWXpez3pdxElFsZ-zOkixkztqo157eTvRyPA1GchX1K3eTkQsLWPExtIZwcydXIYnxH1glWPIKLycLAfiOQ"
  };
  var options = {
    'method' : 'get',
    'contentType': 'application/json',
    'headers': headers,
    'muteHttpExceptions': true
  };
  const options_ = { year: 'numeric', month: 'numeric', day: 'numeric' };

  var today = new Date();
  console.log(today.toLocaleString(undefined, options_));
  console.log(today);
  var month = today.getMonth() + 1;
  if (month < 10)
  {month = "0" + month};

  var date = today.getFullYear() + "/" + month + "/" + today.getDate();
  var date2 = today.getFullYear() + month + today.getDate();
  console.log(date);
  var urls = "https://api.euskadi.eus/euskalmet/weather/regions/basque_country/forecast/at/" + date + "/for/" + date2;
  console.log(urls);

  const response = fetch(urls, options);

  fetch(urls, options)
  .then(response => response.json())
  .then(data => {
        const root = document.getElementById('root');
        const tempTabla = document.getElementById('tempTabla');

        console.log(data);
        console.log(data['forecastTextByLang']['BASQUE']);
        console.log(data['citiesTemperatureRange'].length);
        var htmlTabla= "";
        for (var i=0; i < data['citiesTemperatureRange'].length; i++){
        console.log(data['citiesTemperatureRange'][i]['locationId']);
        console.log(data['citiesTemperatureRange'][i]['temperature']['min']);
        console.log(data['citiesTemperatureRange'][i]['temperature']['max']);
        htmlTabla += " <tr><td>" + data['citiesTemperatureRange'][i]['locationId'] + "</td> ";
        htmlTabla += "<td>" + data['citiesTemperatureRange'][i]['temperature']['min'] + "</td> ";
        htmlTabla += "<td>" + data['citiesTemperatureRange'][i]['temperature']['max'] + "</td> </tr>";

        }
        console.log(htmlTabla);
        var forecastTextBasque = data['forecastTextByLang']['BASQUE'];
        var html = "<p>" + forecastTextBasque + "</p>";
        root.innerHTML = html;
        tempTabla.innerHTML = htmlTabla;

        });

}, false);
</script>
{% endblock %}
